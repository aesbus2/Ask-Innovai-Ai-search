<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Metro AI Call Center Analytics v6.0.0 - Production</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet" href="/static/chatstyles.css" />
    <link rel="stylesheet" href="/static/transcript-search.css">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                <span class="material-icons">analytics</span>
                InnovAI Call Center Analytics                
            </h1>
            <div class="header-controls">
                <button class="header-btn" onclick="exportChat()">
                    <span class="material-icons">download</span>
                    <span>Export</span>
                </button>
                <button class="header-btn" onclick="clearChat()">
                    <span class="material-icons">refresh</span>
                    <span>Clear</span>
                </button>
            </div>
        </div>

        <div class="main-layout">
            <!-- Left Panel: Sidebar with Filter Tabs -->
            <div class="left-panel">
                <!-- Filter Tabs positioned relative to sidebar -->
                <div class="filter-tabs">
                    <!-- Filter Toggle Tab -->
                    <div class="sidebar-tab" onclick="toggleSidebar()" id="sidebarTab">
                        <span class="material-icons">menu_open</span>
                        <span class="tab-text">FILTERS</span>
                    </div>

                    <!-- Apply Filters Tab -->
                    <div class="apply-tab" onclick="applyFiltersAndClose()" id="applyTab">
                        <span class="material-icons">check</span>
                        <span class="tab-text">APPLY</span>
                    </div>

                    <!-- Cancel Filters Tab -->
                    <div class="cancel-tab" onclick="cancelFilters()" id="cancelTab">
                        <span class="material-icons">close</span>
                        <span class="tab-text">CANCEL</span>
                    </div>
                </div>

                <!-- Sidebar - Always visible but can be collapsed -->
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <h3>Real-Time Analytics Filters</h3>
                        <p>All options loaded from live evaluation database</p>
                    </div>

                    <div class="filter-panel">
                        <!-- Date Filters -->
                        <div class="filter-section">
                            <h4>
                                <div class="section-title">
                                    <span class="material-icons">date_range</span>
                                    Date & Time Filters
                                </div>
                            </h4>
                            <div class="filter-content">
                                <div class="filter-group">
                                    <label class="filter-label">Call Date Range</label>
                                    <div class="date-range">
                                        <input type="date" id="startCallDate" class="filter-input" title="Start Date">
                                        <input type="date" id="endCallDate" class="filter-input" title="End Date">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Organizational Hierarchy -->
                        <div class="filter-section">
                            <h4>
                                <div class="section-title">
                                    <span class="material-icons">account_tree</span>
                                    Organizational Hierarchy
                                </div>
                                <span id="hierarchyDataStatus" class="data-status data-status-ok">
                                    ‚úÖ Ready
                                </span>
                            </h4>
                            <div class="filter-content">
                                <div class="hierarchy-note">
                                    <strong>REAL DATA Filters:</strong> Template (evaluation form) ‚Üí Program (business
                                    unit) ‚Üí Partner ‚Üí Site ‚Üí LOB
                                    <br><small>All options loaded from your actual evaluation database</small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Template (Evaluation Form)
                                        <span id="templateCount" class="count-indicator"></span>
                                    </label>
                                    <select id="templateFilter" class="filter-select"
                                        onchange="updateHierarchyFilters('template')">
                                        <option value="">All Templates</option>
                                    </select>
                                    <small class="filter-help">
                                        InnovAi QA evaluation templates
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Program (Business Unit)
                                        <span id="programCount" class="count-indicator"></span>
                                    </label>
                                    <select id="programFilter" class="filter-select"
                                        onchange="updateHierarchyFilters('program')">
                                        <option value="">All Programs</option>
                                    </select>
                                    <small class="filter-help">
                                       Metro, ASW, T-Mobile Prepaid
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Partner (Vendor)
                                        <span id="partnerCount" class="count-indicator"></span>
                                    </label>
                                    <select id="partnerFilter" class="filter-select"
                                        onchange="updateHierarchyFilters('partner')">
                                        <option value="">All Partners</option>
                                    </select>
                                    <small class="filter-help">
                                        Call center vendors
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Site (Location)
                                        <span id="siteCount" class="count-indicator"></span>
                                    </label>
                                    <select id="siteFilter" class="filter-select" onchange="updateHierarchyFilters('site')">
                                        <option value="">All Sites</option>
                                    </select>
                                    <small class="filter-help">
                                        where the site is located
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Line of Business (LOB)
                                        <span id="lobCount" class="count-indicator"></span>
                                    </label>
                                    <select id="lobFilter" class="filter-select">
                                        <option value="">All LOBs</option>
                                    </select>
                                    <small class="filter-help">
                                        CSR, DSG, WNP, Specialty, etc.
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Call Identifiers -->
                        <div class="filter-section">
                            <h4>
                                <div class="section-title">
                                    <span class="material-icons">fingerprint</span>
                                    Call Identifiers
                                </div>
                            </h4>
                            <div class="filter-content">
                                <div class="filter-group">
                                    <label class="filter-label">Evaluation ID</label>
                                    <input type="text" id="evaluationIdFilter" class="filter-input"
                                        placeholder="Enter evaluation ID...">
                                    <small class="filter-help">
                                        Unique evaluation identifier
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">Agent Name</label>
                                    <input type="text" id="agentNameFilter" class="filter-input"
                                        placeholder="Enter agent name...">
                                    <small class="filter-help">
                                        Agent's full name or partial match
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">Agent ID</label>
                                    <input type="text" id="agentIdFilter" class="filter-input"
                                        placeholder="Enter agent ID...">
                                    <small class="filter-help">
                                        Unique agent identifier
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Call Metadata -->
                        <div class="filter-section">
                            <h4>
                                <div class="section-title">
                                    <span class="material-icons">call</span>
                                    Call Information
                                </div>
                                <span id="callMetaDataStatus" class="data-status data-status-ok">
                                    ‚úÖ Ready
                                </span>
                            </h4>
                            <div class="filter-content">
                                <div class="filter-group">
                                    <label class="filter-label">
                                        Disposition (Primary)
                                        <span id="dispositionCount" class="count-indicator"></span>
                                    </label>
                                    <select id="dispositionFilter" class="filter-select"
                                        onchange="updateSubDispositions()">
                                        <option value="">All Dispositions</option>
                                    </select>
                                    <small class="filter-help">
                                        Primary call outcome
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Sub-Disposition
                                        <span id="subDispositionCount" class="count-indicator"></span>
                                    </label>
                                    <select id="subDispositionFilter" class="filter-select">
                                        <option value="">All Sub-Dispositions</option>
                                    </select>
                                    <small class="filter-help">
                                        Secondary call outcome
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">
                                        Language
                                        <span id="languageCount" class="count-indicator"></span>
                                    </label>
                                    <select id="languageFilter" class="filter-select">
                                        <option value="">All Languages</option>
                                    </select>
                                    <small class="filter-help">
                                        Call language (EN, ES, etc.)
                                    </small>
                                </div>

                                <div class="filter-group">
                                    <label class="filter-label">Call Duration (seconds)</label>
                                    <div class="input-grid">
                                        <input type="number" id="minDurationFilter" class="filter-input"
                                            placeholder="Min" min="0">
                                        <input type="number" id="maxDurationFilter" class="filter-input"
                                            placeholder="Max" min="0">
                                    </div>
                                    <small class="filter-help">
                                        Call length in seconds
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Quality Scoring -->
                        <div class="filter-section">
                            <h4>
                                <div class="section-title">
                                    <span class="material-icons">assessment</span>
                                    Quality Scoring
                                </div>
                            </h4>
                            <div class="filter-content">
                                <div class="filter-group">
                                    <label class="filter-label">Weighted Score Range</label>
                                    <div class="input-grid">
                                        <input type="number" id="minScoreFilter" class="filter-input"
                                            placeholder="Min Score" min="0" max="100" step="0.1">
                                        <input type="number" id="maxScoreFilter" class="filter-input"
                                            placeholder="Max Score" min="0" max="100" step="0.1">
                                    </div>
                                    <small class="filter-help">
                                        0-100 quality score range
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Actions - Bottom of sidebar -->
                    <div class="filter-actions">
                        <button class="apply-btn" onclick="applyFilters()">
                            <span class="material-icons">search</span>
                            Apply Filters
                        </button>
                        <button class="clear-btn" onclick="clearFilters()">
                            <span class="material-icons">clear_all</span>
                            Clear All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Chat Area (Full Width) -->
            <div class="chat-area">
                <div class="chat-header">
                    <div class="chat-header-top">
                        <div>
                            <div class="chat-title">Metro AI Assistant</div>
                            <div class="chat-subtitle">Real-time call center analytics and insights</div>
                        </div>
                        <div class="chat-stats">
                            <div class="stat-item">
                                <span class="material-icons">filter_list</span>
                                <span id="activeFiltersCount">0 filters</span>
                            </div>
                            <div class="stat-item">
                                <span class="material-icons">analytics</span>
                                <span id="totalRecords">0 evaluations</span>
                            </div>
                            <div class="stat-item comprehensive-search-toggle">
                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; margin: 0;">
                                    <input type="checkbox" id="comprehensiveToggle" onchange="updateComprehensiveMode()" 
                                           style="margin: 0; width: 16px; height: 16px;">
                                    <span class="material-icons" style="font-size: 18px;">search</span>
                                    <span style="font-size: 14px;">Comprehensive</span>
                                </label>
                                <div id="searchModeDescription" style="font-size: 12px; color: #999; font-style: italic; margin-left: 40px;">
                                    (Smart detection)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="chat-header-filters" id="activeFiltersDisplay">
                        <!-- Active filters will be displayed here as tags -->
                    </div>
                </div>

                <div class="messages-container" id="messagesContainer">
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-icon">üí¨</div>
                        <h2 class="welcome-title">Ready to Analyze</h2>
                        <p class="welcome-subtitle">
                            Use filters to narrow your dataset, then ask questions about call center performance,
                            agent quality, or specific evaluations.
                        </p>

                        <div class="example-questions">
                            <div class="example-card"
                                onclick="sendMessage('Show me top performing agents by weighted score')">
                                <h4>Agent Performance</h4>
                                <p>Analyze agent quality scores and identify top performers</p>
                                <span class="card-more-indicator">Click to analyze ‚Üí</span>
                            </div>
                            <div class="example-card"
                                onclick="sendMessage('What are the most common call dispositions?')">
                                <h4>Call Outcomes</h4>
                                <p>Review call dispositions and resolution patterns</p>
                                <span class="card-more-indicator">Click to explore ‚Üí</span>
                            </div>
                            <div class="example-card"
                                onclick="sendMessage('Compare partner performance across sites')">
                                <h4>Partner Analysis</h4>
                                <p>Compare vendor performance metrics across locations</p>
                                <span class="card-more-indicator">Click to compare ‚Üí</span>
                            </div>
                        </div>
                    </div>

                    <!-- Messages will be dynamically added here -->
                </div>

                <!-- Quick Questions -->
                <div class="quick-questions" id="quickQuestions" style="display: none;">
                    <h4>Suggested Follow-up Questions:</h4>
                    <div class="question-buttons" id="questionButtons">
                        <!-- Dynamic buttons will be added here -->
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="chat-input-area">
                    <div class="input-container">
                        <textarea id="chatInput" class="chat-input"
                            placeholder="Ask specific questions about calls, dispositions, site performance, quality metrics, or any evaluation data from your live database..."
                            rows="1"></textarea>
                        <button id="sendButton" class="send-btn" onclick="sendMessage()">
                            <span class="material-icons">send</span>
                            Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Initialize sidebar functionality
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Metro AI Call Center Analytics initialized');
        
        // Initialize filter display monitoring
        initializeFilterMonitoring();
        
        // Initialize sidebar state
        const sidebar = document.getElementById('sidebar');
        const sidebarTab = document.getElementById('sidebarTab');
        const applyTab = document.getElementById('applyTab');
        const cancelTab = document.getElementById('cancelTab');
        
        if (sidebar && sidebarTab) {
            console.log('‚úÖ Sidebar elements found and initialized');
        }
        
        if (applyTab) {
            console.log('‚úÖ Apply tab initialized');
        }
        
        if (cancelTab) {
            console.log('‚úÖ Cancel tab initialized');
        }
        
        removeBackdrop(); // Clean up any existing backdrop
        
        // Ensure applyFilters function is available
        if (typeof window.applyFilters !== 'function') {
            console.warn('‚ö†Ô∏è applyFilters function not yet loaded, will be available when chat.js loads');
        }
        
        console.log('üìä Filter enhancement available via manual functions only');
        console.log('üí° Use enhanceNow() or testEnhancedDisplay() to enhance filter display');
    });
    
    // Placeholder functions that will be replaced by chat.js
    window.toggleSidebar = window.toggleSidebar || function() {
        const sidebar = document.getElementById('sidebar');
        const leftPanel = document.querySelector('.left-panel');
        
        if (sidebar && leftPanel) {
            sidebar.classList.toggle('collapsed');
            leftPanel.classList.toggle('collapsed');
        }
    };
    
    window.applyFiltersAndClose = window.applyFiltersAndClose || function() {
        console.log('üîÑ Apply filters and close called - waiting for chat.js...');
        if (typeof window.applyFilters === 'function') {
            window.applyFilters();
        }
        // Don't close sidebar in this layout - it stays visible
    };
    
    window.cancelFilters = window.cancelFilters || function() {
        console.log('‚ùå Cancel filters called');
        // Clear any pending filter changes if needed
        // Don't close sidebar in this layout - it stays visible
    };
    
    // Initialize other functions as needed
    window.sendMessage = window.sendMessage || function(message) {
        console.log('üí¨ Send message called:', message);
    };
    
    window.exportChat = window.exportChat || function() {
        console.log('üì• Export chat called');
    };
    
    window.clearChat = window.clearChat || function() {
        console.log('üîÑ Clear chat called');
    };
    
    // Filter monitoring and enhancement functions
    function initializeFilterMonitoring() {
        // Initialize with basic values
        const activeElement = document.getElementById('activeFiltersCount');
        const totalElement = document.getElementById('totalRecords');
        
        if (activeElement) activeElement.textContent = '0 filters';
        if (totalElement) totalElement.textContent = '0 evaluations';
        
        console.log('üìä Filter display initialized');
    }
    
    // Debug functions
    window.testElementsVisibility = function() {
        console.log('üß™ Testing element visibility...');
        
        const totalElement = document.getElementById('totalRecords');
        const activeElement = document.getElementById('activeFiltersCount');
        
        if (totalElement) {
            totalElement.textContent = 'TEST: 9,999 evaluations';
            totalElement.style.color = 'red';
            totalElement.style.fontWeight = 'bold';
            console.log('‚úÖ totalRecords element found and updated');
        } else {
            console.error('‚ùå totalRecords element NOT FOUND');
        }
        
        if (activeElement) {
            activeElement.textContent = 'TEST: 5 filters';
            activeElement.style.color = 'red';
            activeElement.style.fontWeight = 'bold';
            console.log('‚úÖ activeFiltersCount element found and updated');
        } else {
            console.error('‚ùå activeFiltersCount element NOT FOUND');
        }
    };
    </script>

    <script src="/static/chat.js"></script>
</body>
</html>
